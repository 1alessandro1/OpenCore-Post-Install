(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{395:function(t,e,a){t.exports=a.p+"assets/img/pm-working.6d53e2d0.png"},396:function(t,e,a){t.exports=a.p+"assets/img/pm-not-working.2706013b.png"},397:function(t,e,a){t.exports=a.p+"assets/img/lpm.79ebcb8e.png"},398:function(t,e,a){t.exports=a.p+"assets/img/macbook.30e3c75e.png"},399:function(t,e,a){t.exports=a.p+"assets/img/epp.17b6b741.png"},400:function(t,e,a){t.exports=a.p+"assets/img/done.520d0bc4.png"},401:function(t,e,a){t.exports=a.p+"assets/img/files.30824430.png"},402:function(t,e,a){t.exports=a.p+"assets/img/prgen-run.224e35cf.png"},403:function(t,e,a){t.exports=a.p+"assets/img/prgen-done.543f80ef.png"},458:function(t,e,a){"use strict";a.r(e);var n=a(25),i=Object(n.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"optimizing-power-management"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#optimizing-power-management"}},[t._v("#")]),t._v(" Optimizing Power Management")]),t._v(" "),n("p",[n("extoc")],1),t._v(" "),n("h2",{attrs:{id:"enabling-x86platformplugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#enabling-x86platformplugin"}},[t._v("#")]),t._v(" Enabling X86PlatformPlugin")]),t._v(" "),n("p",[t._v("So before we can fine tune power management to our liking, we need to first make sure Apple's XCPM core is loaded. Note that this is supported "),n("strong",[t._v("only on Haswell and newer")]),t._v(", Sandy, Ivy Bridge and AMD CPUs should refer to the bottom of the guides:")]),t._v(" "),n("ul",[n("li",[n("RouterLink",{attrs:{to:"/universal/pm.html#sandy-and-ivy-bridge-power-management"}},[t._v("Sandy and Ivy Bridge Power Management")])],1),t._v(" "),n("li",[n("RouterLink",{attrs:{to:"/universal/pm.html#amd-cpu-power-management"}},[t._v("AMD CPU Power Management")])],1)]),t._v(" "),n("p",[t._v("To start, grab "),n("a",{attrs:{href:"https://github.com/khronokernel/IORegistryClone/blob/master/ioreg-302.zip",target:"_blank",rel:"noopener noreferrer"}},[t._v("IORegistryExplorer"),n("OutboundLink")],1),t._v(" and look for "),n("code",[t._v("AppleACPICPU")]),t._v("(note if you use search, it won't show the children so clear your search once you've found the entry):")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("XCPM Present")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("Missing XCPM")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[n("img",{attrs:{src:a(395),alt:""}})]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[n("img",{attrs:{src:a(396),alt:""}})])])])]),t._v(" "),n("p",[t._v("As you can see from the left image, we have the X86PlatformPlugin attached meaning Apple's CPU Power Management Drivers are doing their thing. If you get something like to the right image, then there's likely an issue. Make sure to check the following:")]),t._v(" "),n("ul",[n("li",[t._v("SSDT-PLUG."),n("strong",[t._v("aml")]),t._v(" is both present and enabled in your config.plist and EFI/OC/ACPI\n"),n("ul",[n("li",[t._v("If you're missing this, head to "),n("a",{attrs:{href:"https://dortanian.github.io/Getting-Started-With-ACPI",target:"_blank",rel:"noopener noreferrer"}},[t._v("Getting Started With ACPI"),n("OutboundLink")],1),t._v(" on how to make this")])])]),t._v(" "),n("li",[t._v("SSDT-PLUG is set to the first thread of your CPU, you can check by selecting the first CPU listed("),n("code",[t._v("CP00")]),t._v(" for our example) and make sure you have this in the properties:")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("plugin-type | Number | 0x1\n")])])]),n("p",[n("strong",[t._v("X99 Note")]),t._v(":")]),t._v(" "),n("p",[t._v("XCPM does not natively support Haswell-E and Broadwell-E, this means we need to spoof the CPU ID into a model that does supports XCPM:")]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[t._v("Haswell E")]),t._v(":")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("Kernel -> Emulate")]),t._v(":\n"),n("ul",[n("li",[t._v("Cpuid1Data\ufeff: "),n("code",[t._v("C3060300 00000000 00000000 00000000")])]),t._v(" "),n("li",[t._v("Cpuid1Mask: "),n("code",[t._v("FFFFFFFF 00000000 00000000 00000000")])])])])])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("Broadwell-E")]),t._v(":")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("Kernel -> Emulate")]),t._v(":\n"),n("ul",[n("li",[t._v("Cpuid1Data\ufeff: "),n("code",[t._v("D4060300\ufeff 00000000 00000000 00000000")])]),t._v(" "),n("li",[t._v("Cpuid1Mask: "),n("code",[t._v("FFFFFFFF 00000000 00000000 00000000")])])])])])])]),t._v(" "),n("h2",{attrs:{id:"using-cpu-friend"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#using-cpu-friend"}},[t._v("#")]),t._v(" Using CPU Friend")]),t._v(" "),n("p",[t._v("To start, we're gonna need a couple things:")]),t._v(" "),n("ul",[n("li",[t._v("X86PlatformPlugin loaded\n"),n("ul",[n("li",[t._v("This means Sandy, Ivy Birdge and AMD CPUs are not supported")])])]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/acidanthera/CPUFriend/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("CPUFriend"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/corpnewt/CPUFriendFriend",target:"_blank",rel:"noopener noreferrer"}},[t._v("CPUFriendFriend"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("Now lets run CPUFriendFriend.command")]),t._v(" "),n("p",[n("img",{attrs:{src:a(397),alt:""}})]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("min hex freq")]),t._v(" should be what the lowest possible TDP for the CPU, on Intel's "),n("a",{attrs:{href:"https://ark.intel.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ARK site"),n("OutboundLink")],1),t._v(" search for "),n("code",[t._v("TDP-down Frequency")]),t._v(" and convert this value to HEX. Note that not all CPUs support "),n("code",[t._v("TDP-down Frequency")]),t._v(", like the i7-9700T vs i7 9700. In these scenarios, you'll want to do a bit more research into your CPU, specifically:")]),t._v(" "),n("ul",[n("li",[t._v("Minimum Multiplier (Generally stable with x10 on Intel's consumer platform)")]),t._v(" "),n("li",[t._v("FSB (Front Side Bus Frequency, this is 100MHz on most CPUs)")])]),t._v(" "),n("p",[t._v("LPM = MinMultiplier x FSB")]),t._v(" "),n("p",[t._v("For this example we'll be using the "),n("a",{attrs:{href:"https://ark.intel.com/content/www/us/en/ark/products/126240/intel-core-i9-7920x-x-series-processor-16-5m-cache-up-to-4-30-ghz.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("i9 7920x"),n("OutboundLink")],1),t._v(" which has a base clock of 2.9 GHz but no LPM, so we'll choose 1.3 GHz(13x100) and work our way up/down until we find stability.")]),t._v(" "),n("p",[n("strong",[t._v("Note")]),t._v(":  Mobile SMBIOS will likely have several Frequency Vectors, this is for how many steps your CPU will take. On the MacBook9,1 SMBIOS for example, we get 3 Frequency Vectors. So the idea is:")]),t._v(" "),n("ol",[n("li",[t._v("Lowest frequency macOS will idle at(ie. sitting at the desktop)")]),t._v(" "),n("li",[t._v("Middle frequency for simple tasks(ie. text editing or using the finder)")]),t._v(" "),n("li",[t._v("Average frequency for little more demanding tasks(ie. Safari, Youtube, etc)")])]),t._v(" "),n("p",[t._v("The last frequency is not your maximum frequency so don't worry about being capped at that limit.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(398),alt:""}})]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('echo "obase=16; 13" | bc\n')])])]),n("p",[n("img",{attrs:{src:a(399),alt:""}})]),t._v(" "),n("p",[t._v("Next up is the Energy Performance Preference, EPP. This tells macOS how fast to turbo up the CPU to its full clock. "),n("code",[t._v("00")]),t._v(" will tell macOS to let the CPU go as fast as it can as quickly as it can while "),n("code",[t._v("FF")]),t._v(" will tell macOS to take things slowly and let the CPU ramp up over a much longer period of time. Depending on what you're doing and the cooling on your machine, you may want to set something in the middle. Below chart can help out a bit:")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("EPP")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("Speed")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("0x00-0x3F")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Max Performance")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("0x40-0x7F")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Balance performance")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("0x80-0xBF")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Balance power")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("0xC0-0xFF")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Max Power Saving")])])])]),t._v(" "),n("p",[n("strong",[t._v("Note")]),t._v(": Only Skylake and newer SMBIOS officially support EPP")]),t._v(" "),n("p",[n("img",{attrs:{src:a(400),alt:""}}),t._v(" "),n("img",{attrs:{src:a(401),alt:""}})]),t._v(" "),n("p",[t._v("Once you're finished, you'll be provided with a CPUFriendDataProvider.kext and ssdt_data.aml. Which you choose is your preference but I recommend the kext variant to avoid any headaches with data injection into Windows and Linux.")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("Note")]),t._v(": Load order does not matter with the CPUFriendDataProvider as it's just a plist-only kext")]),t._v(" "),n("li",[n("strong",[t._v("Note 2")]),t._v(": Wake issues resulting from CPUFriend is likely due to incorrect frequency vectors, every system is unique so you'll need to play around until you get a stable config. Kernel panics will have "),n("code",[t._v("Sleep Wake failure in efi")]),t._v(".")])]),t._v(" "),n("h2",{attrs:{id:"sandy-and-ivy-bridge-power-management"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sandy-and-ivy-bridge-power-management"}},[t._v("#")]),t._v(" Sandy and Ivy Bridge Power Management")]),t._v(" "),n("p",[t._v("With Sandy and Ivy Bridge, consumer PCs have issues connecting to Apple's XCPM. So to get around this we need to create our own Power Management Table.")]),t._v(" "),n("p",[t._v("What we'll need:")]),t._v(" "),n("ul",[n("li",[t._v("CpuPm and Cpu0Ist tables dropped")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/Piker-Alpha/ssdtPRGen.sh",target:"_blank",rel:"noopener noreferrer"}},[t._v("ssdtPRGen"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("To drop the CpuPm and Cpu0Ist tables, head to ACPI -> Delete:")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("Key")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("Value")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("All")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("YES")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("Comment")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Drop CpuPm")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("Enabled")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("YES")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("OemTableId")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Data")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("437075506d000000")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("TableLength")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Number")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("0")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("TableSignature")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Data")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("53534454")])])])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("Key")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("Value")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("All")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("YES")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("Comment")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Drop Cpu0Ist")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("Enabled")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("YES")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("OemTableId")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Data")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("4370753049737400")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("TableLength")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Number")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("0")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("TableSignature")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("Data")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("53534454")])])])]),t._v(" "),n("p",[t._v("Once this is done, we can now grab ssdtPRGen and run it:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(402),alt:""}})]),t._v(" "),n("p",[t._v("Once you're done, you'll be provided with an SSDT.aml under "),n("code",[t._v("/Users/your-name>/Library/ssdtPRGen/ssdt.dsl")]),t._v(", you can easily find it with the Cmd+Shift+G shortcut and pasting "),n("code",[t._v("~/Library/ssdtPRGen/")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(403),alt:""}})]),t._v(" "),n("p",[t._v("Remember to now add this to both EFI/OC/ACPI and your config.plist, I recommend renaming it to SSDT-PM to find it more easily")]),t._v(" "),n("h2",{attrs:{id:"amd-cpu-power-management"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#amd-cpu-power-management"}},[t._v("#")]),t._v(" AMD CPU Power Management")]),t._v(" "),n("p",[t._v("While macOS might not officially support AMD CPU Power management, there are community efforts to add it. Specifically being "),n("a",{attrs:{href:"https://github.com/trulyspinach/SMCAMDProcessor",target:"_blank",rel:"noopener noreferrer"}},[t._v("SMCAMDProcessor"),n("OutboundLink")],1),t._v(". Note that when adding this kext, it should be after VirtualSMC in your config.plist as it's a plugin.")])])}),[],!1,null,null,null);e.default=i.exports}}]);